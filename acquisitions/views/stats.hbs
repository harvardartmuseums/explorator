<h1>{{stats.info.totalrecords}} objects</h1>


<div id="year-plot"></div>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        plotStats();
    });

    function plotStats() {
        const data = [
        {{#each stats.aggregations.by_year.buckets}}
            { count:{{doc_count}}, year:"{{key_as_string}}" },
        {{/each}}    
        ];

        const plot = Plot.plot({
            y: {grid: true},
            x: {type: 'band'},
            marks: [
                Plot.barY(data, {x: "year", y: "count", sort: {x: "x", order: "descending"}, tip: true}),
                Plot.ruleY([0])
            ],
            height: 400,
            width: 600,
            marginTop: 20, // ðŸŒ¶ if you don't set the margins, the defaults flip the scales bottom-up
            marginBottom: 40,
            marginLeft: 50,
            marginRight: 20
        })

        let div = document.getElementById("year-plot");
        div.append(plot);   
    }
</script>